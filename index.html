<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            padding: 16px;
            padding-bottom: 80px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--tg-theme-hint-color, #ddd);
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: var(--tg-theme-hint-color, #999);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--tg-theme-button-color, #0088cc);
            border-bottom-color: var(--tg-theme-button-color, #0088cc);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--tg-theme-text-color, #000);
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            resize: vertical;
        }

        textarea {
            min-height: 100px;
            font-family: inherit;
        }

        textarea.large {
            min-height: 150px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #fff);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.3s;
        }

        .file-input-label:hover {
            opacity: 0.9;
        }

        input[type="file"] {
            display: none;
        }

        .preview-section {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
            padding: 16px;
        }

        .preview-post {
            background: #fff;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .preview-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 12px;
            max-height: 400px;
            object-fit: cover;
        }

        .preview-text {
            white-space: pre-wrap;
            line-height: 1.5;
            color: #000;
        }

        .preview-button {
            display: inline-block;
            background: #0088cc;
            color: #fff;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 8px;
        }

        .info-text {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
            margin-top: 4px;
        }

        .image-preview-container {
            margin-top: 12px;
            position: relative;
        }

        .remove-image {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .error-message {
            color: #e53935;
            font-size: 14px;
            margin-top: 8px;
        }

        .team-row {
            display: flex;
            gap: 12px;
        }

        .team-row .form-group {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="tabs">
        <button class="tab active" data-tab="editor">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
        <button class="tab" data-tab="preview">–ü—Ä–µ–≤—å—é</button>
    </div>

    <div id="editor" class="tab-content active">
        <form id="forecastForm">
            <div class="team-row">
                <div class="form-group">
                    <label for="team1">–ö–æ–º–∞–Ω–¥–∞ 1 *</label>
                    <input type="text" id="team1" required placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∫–æ–º–∞–Ω–¥—ã">
                </div>
                <div class="form-group">
                    <label for="team2">–ö–æ–º–∞–Ω–¥–∞ 2 *</label>
                    <input type="text" id="team2" required placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–π –∫–æ–º–∞–Ω–¥—ã">
                </div>
            </div>

            <div class="form-group">
                <label for="matchTime">–í—Ä–µ–º—è –º–∞—Ç—á–∞ *</label>
                <input type="text" id="matchTime" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 16:30 –ú–°–ö">
                <div class="info-text">–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú –∏ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å</div>
            </div>

            <div class="form-group">
                <label for="postText">–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ *</label>
                <textarea id="postText" class="large" required placeholder="–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–≤–∏–¥—è—Ç –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –∫–∞–Ω–∞–ª–∞..."></textarea>
                <div class="info-text">–ö–æ–º–∞–Ω–¥—ã –∏ –≤—Ä–µ–º—è –¥–æ–±–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
            </div>

            <div class="form-group">
                <label for="forecast">–ü—Ä–æ–≥–Ω–æ–∑ *</label>
                <textarea id="forecast" required placeholder="–¢–µ–∫—Å—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞, –∫–æ—Ç–æ—Ä—ã–π —É–≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏..."></textarea>
                <div class="info-text">–≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª—É—á–∞—Ç —Ç–æ–ª—å–∫–æ —Ç–µ, –∫—Ç–æ –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –∏ –ø–æ–¥–ø–∏—Å–∞–Ω</div>
            </div>

            <div class="form-group">
                <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                <div class="file-input-wrapper">
                    <label for="photo" class="file-input-label">
                        üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    </label>
                    <input type="file" id="photo" accept="image/jpeg,image/png">
                </div>
                <div class="info-text">–§–æ—Ä–º–∞—Ç—ã: JPG, PNG. –ú–∞–∫—Å–∏–º—É–º 10 –ú–ë</div>
                <div id="imagePreview" class="image-preview-container" style="display: none;">
                    <button type="button" class="remove-image" id="removeImage">√ó</button>
                    <img id="previewImg" class="preview-image" alt="Preview">
                </div>
                <div id="imageError" class="error-message" style="display: none;"></div>
            </div>
        </form>
    </div>

    <div id="preview" class="tab-content">
        <div class="preview-section">
            <div class="preview-post">
                <div id="previewImageContainer" style="display: none;">
                    <img id="previewPostImg" class="preview-image" alt="Post image">
                </div>
                <div class="preview-text" id="previewPostText">
                    –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–µ–≤—å—é
                </div>
                <div class="preview-button">üì± –ü–û–õ–£–ß–ò–¢–¨ –ü–†–û–ì–ù–û–ó</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tabName).classList.add('active');
                
                if (tabName === 'preview') {
                    updatePreview();
                }
            });
        });

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
        function getCurrentDate() {
            const months = [
                '–Ø–ù–í–ê–†–Ø', '–§–ï–í–†–ê–õ–Ø', '–ú–ê–†–¢–ê', '–ê–ü–†–ï–õ–Ø', '–ú–ê–Ø', '–ò–Æ–ù–Ø',
                '–ò–Æ–õ–Ø', '–ê–í–ì–£–°–¢–ê', '–°–ï–ù–¢–Ø–ë–†–Ø', '–û–ö–¢–Ø–ë–†–Ø', '–ù–û–Ø–ë–†–Ø', '–î–ï–ö–ê–ë–†–Ø'
            ];
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = months[now.getMonth()];
            return `${day} ${month}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é
        function updatePreview() {
            const team1 = document.getElementById('team1').value;
            const team2 = document.getElementById('team2').value;
            const matchTime = document.getElementById('matchTime').value;
            const postText = document.getElementById('postText').value;

            if (!team1 || !team2 || !matchTime || !postText) {
                document.getElementById('previewPostText').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                return;
            }

            const dateStr = getCurrentDate();
            const fullText = `üîª${team1} - ${team2}üî∫\n\n${dateStr} | ${matchTime}\n\n${postText}\n\nüëá –ú–æ—ë –º–Ω–µ–Ω–∏–µ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ.`;
            
            document.getElementById('previewPostText').textContent = fullText;

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–µ–≤—å—é
            const previewImg = document.getElementById('previewImg');
            const previewPostImg = document.getElementById('previewPostImg');
            const previewImageContainer = document.getElementById('previewImageContainer');

            if (previewImg.src && previewImg.src !== window.location.href) {
                previewPostImg.src = previewImg.src;
                previewImageContainer.style.display = 'block';
            } else {
                previewImageContainer.style.display = 'none';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        document.getElementById('photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const errorDiv = document.getElementById('imageError');
            errorDiv.style.display = 'none';

            if (!file) return;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (10 –ú–ë)
            if (file.size > 10 * 1024 * 1024) {
                errorDiv.textContent = '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 –ú–ë';
                errorDiv.style.display = 'block';
                e.target.value = '';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
            if (!file.type.match('image/(jpeg|png)')) {
                errorDiv.textContent = '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç—ã JPG –∏ PNG';
                errorDiv.style.display = 'block';
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const previewDiv = document.getElementById('imagePreview');
                const previewImg = document.getElementById('previewImg');
                previewImg.src = event.target.result;
                previewDiv.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        document.getElementById('removeImage').addEventListener('click', function() {
            document.getElementById('photo').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('previewImg').src = '';
            document.getElementById('previewImageContainer').style.display = 'none';
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        tg.MainButton.setText('üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑');
        tg.MainButton.show();

        tg.MainButton.onClick(function() {
            const team1 = document.getElementById('team1').value.trim();
            const team2 = document.getElementById('team2').value.trim();
            const matchTime = document.getElementById('matchTime').value.trim();
            const postText = document.getElementById('postText').value.trim();
            const forecast = document.getElementById('forecast').value.trim();

            if (!team1 || !team2 || !matchTime || !postText || !forecast) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            const previewImg = document.getElementById('previewImg');
            const photoData = previewImg.src && previewImg.src !== window.location.href ? previewImg.src : null;

            const data = {
                team1: team1,
                team2: team2,
                match_time: matchTime,
                post_text: postText,
                forecast: forecast,
                photo: photoData
            };

            tg.sendData(JSON.stringify(data));
        });

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –ø—Ä–∏ –≤–≤–æ–¥–µ
        ['team1', 'team2', 'matchTime', 'postText'].forEach(id => {
            document.getElementById(id).addEventListener('input', () => {
                if (document.getElementById('preview').classList.contains('active')) {
                    updatePreview();
                }
            });
        });
    </script>
</body>
</html>
